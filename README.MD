# Nexign Bootcamp Project

Это приложение на Spring Boot, разработанное для управления и генерации записей о звонках (CDR) и 
отчетов об использовании (UDR) для абонентов. Приложение предоставляет RESTful API для генерации 
отчетов и получения данных об использовании для конкретных абонентов или всех абонентов за 
определенный период времени.

## Описание проекта

Приложение эмулирует работу коммутатора, абоненты совершают и принимают звонки. 
Оно генерирует случайные CDR записи для тестирования и позволяет пользователям 
получать UDR и CDR отчеты через REST API. 
Для разработки и тестирования используется in-memory база данных H2.

### Выполненые задачи
- Автоматическая генерация тестовых абонентов и CDR записей при запуске приложения.
- Генерация UDR отчетов для конкретного абонента или всех абонентов.
- Генерация CDR отчетов для конкретного абонента за заданный период времени.

## Зависимости

Проект использует следующие ключевые зависимости:
- **Spring Boot Starter Web** — для создания RESTful API.
- **Spring Boot Starter Data JPA** — для работы с базой данных.
- **H2 Database** — база данных для разработки и тестирования.
- **Lombok** — для уменьшения шаблонного кода (геттеры, сеттеры, конструкторы).
- **Spring Boot Starter Test и JUnit** — для тестирования приложения.

## Конфигурация базы данных

Приложение использует **in-memory H2 базу данных**. 
Для доступа к консоли H2:
- URL: `http://localhost:8080/h2-console`
- JDBC URL: `jdbc:h2:mem:nexign`
- Имя пользователя: `nexign`
- Пароль: (оставьте пустым)

## Запуск приложения

### Требования
- Установлен **Java 17** или выше.

### Шаги для запуска
1. Склонируйте репозиторий:
   ```bash
   git clone https://github.com/your-username/nexign-bootcamp.git
   ```
2. Перейдите в директорию проекта:
   ```bash
   cd nexign-bootcamp
   ```
3. Запустите JAR-файл из корня проекта:
      ```bash
      java -jar bootcamp-0.0.1-SNAPSHOT.jar
      ```

5. Приложение будет доступно по адресу `http://localhost:8080`.

### Примечания
- При запуске приложение автоматически создает 10 тестовых абонентов и случайное количество CDR записей для 2025 года.
- Для проверки базы данных можно использовать H2 консоль по адресу `http://localhost:8080/h2-console`.

---

## Описание эндпоинтов

### 1. Получение UDR для конкретного абонента
- **URL**: `localhost:8080/api/udr/subscriber`
- **Параметры**:
   - `msisdn` (обязательный): Номер телефона абонента (MSISDN), например, `7999000009`.
   - `start` (опциональный): Начальная дата и время в формате ISO-8601 (например, `2025-03-22T00:00:00Z`). Если не указан, используется текущая дата.
   - `end` (опциональный): Конечная дата и время в формате ISO-8601 (например, `2025-12-31T23:59:59Z`). Если не указан, берется годовой диапазон от начальной даты.
- **Описание**: Возвращает отчет UDR (Usage Detail Record) для указанного абонента за заданный период. Включает общее время входящих и исходящих звонков.
- **Пример использования**:
  ```
  localhost:8080/api/udr/subscriber?msisdn=7999000009&start=2025-03-22T00:00:00Z&end=2025-12-31T23:59:59Z
  ```
- **Пример ответа**:
  ```json
  {
    "msisdn": "7999000009",
    "incomingCall": {
      "totalTime": "00:15:30"
    },
    "outgoingCall": {
      "totalTime": "00:45:00"
    }
  }
  ```

### 2. Получение UDR для всех абонентов
- **URL**: `localhost:8080/api/udr/all`
- **Параметры**:
   - `month` (обязательный): Месяц в формате `YYYY-MM`, например, `2025-03`.
- **Описание**: Возвращает отчеты UDR для всех абонентов за указанный месяц. Каждый отчет содержит общее время входящих и исходящих звонков.
- **Пример использования**:
  ```
  localhost:8080/api/udr/all?month=2025-03
  ```
- **Пример ответа**:
  ```json
  [
    {
      "msisdn": "7999000001",
      "incomingCall": {
        "totalTime": "01:00:00"
      },
      "outgoingCall": {
        "totalTime": "02:30:00"
      }
    },
    {
      "msisdn": "7999000002",
      "incomingCall": {
        "totalTime": "00:45:00"
      },
      "outgoingCall": {
        "totalTime": "01:15:00"
      }
    }
  ]
  ```

### 3. Генерация CDR отчета для абонента
- **URL**: `localhost:8080/api/cdr/report`
- **Параметры**:
   - `msisdn` (обязательный): Номер телефона абонента (MSISDN), например, `7999000009`.
   - `start` (обязательный): Начальная дата и время в формате ISO-8601 (например, `2025-01-01T00:00:00Z`).
   - `end` (обязательный): Конечная дата и время в формате ISO-8601 (например, `2025-12-31T00:00:00Z`).
- **Описание**: Генерирует отчет CDR (Call Detail Record) для указанного абонента за заданный период и сохраняет его в CSV-файл в директории с запущеным JAR-файлом. Возвращает статус операции и уникальный идентификатор (UUID) файла.
- **Пример использования**:
  ```
  localhost:8080/api/cdr/report?msisdn=7999000009&start=2025-01-01T00:00:00Z&end=2025-12-31T00:00:00Z
  ```
- **Пример ответа**:
  ```json
  {
    "status": "success",
    "uuid": "123e4567-e89b-12d3-a456-426614174000"
  }
  ```
- **Примечание**: Если данных за указанный период нет, возвращается статус `"failed"` с сообщением об ошибке.

---

## Дополнительная информация
- Все временные параметры должны быть в формате ISO-8601 с часовым поясом UTC (например, `2025-01-01T00:00:00Z`).
- Если данные для запроса отсутствуют, API возвращает статус `"failed"` с пояснением.

---
## Ссылка на Postman Collection 

```
https://dark-star-323577.postman.co/workspace/My-Workspace~728ce30e-7a47-4e06-8d0d-128eba1dd254/collection/27118932-1a7962a5-6849-4b25-a91b-092d331749c1?action=share&creator=27118932
```

